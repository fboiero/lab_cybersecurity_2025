# CLASE 7 ‚Äì SEGURIDAD EN LA NUBE Y VIRTUALIZACI√ìN

## UTN | Laboratorio de Blockchain y Ciberseguridad

---

## CONTEXTO GENERAL DE LA MATERIA

### Laboratorio de Ciberseguridad
Este curso forma parte del programa de formaci√≥n en ciberseguridad de la UTN, enfocado en competencias pr√°cticas para la identificaci√≥n, an√°lisis y mitigaci√≥n de vulnerabilidades en entornos reales y simulados.

**√Åreas cubiertas en el programa:**
- Fundamentos de seguridad inform√°tica
- An√°lisis de vulnerabilidades y pentesting
- Seguridad en redes y sistemas
- Criptograf√≠a aplicada
- Seguridad en aplicaciones web
- Forense digital
- **Seguridad en la nube y virtualizaci√≥n** (Clase 7)
- Respuesta a incidentes
- Gesti√≥n de riesgos y compliance

---

## OBJETIVOS DE LA CLASE

Al finalizar esta clase, el estudiante ser√° capaz de:

- ‚úÖ Comprender los riesgos y desaf√≠os de la seguridad en entornos cloud
- ‚úÖ Aplicar controles y herramientas para proteger infraestructura virtualizada
- ‚úÖ Identificar configuraciones inseguras y vulnerabilidades comunes
- ‚úÖ Realizar auditor√≠as b√°sicas de entornos simulados de nube
- ‚úÖ Implementar pol√≠ticas de seguridad basadas en el principio de m√≠nimo privilegio
- ‚úÖ Analizar y remediar exposiciones de datos en servicios cloud

---

## PARTE TE√ìRICA

### üìä INTRODUCCI√ìN

> **Estad√≠stica clave:**
> "El 94% de las empresas ya usa servicios cloud, pero solo el 40% tiene pol√≠ticas de seguridad espec√≠ficas."

**Conceptos fundamentales:**
- La nube no es insegura: lo inseguro es no entender qui√©n es responsable
- Seguridad cloud ‚â† seguridad tradicional
- La responsabilidad es compartida, pero no se terceriza

---

### üèóÔ∏è MODELOS DE SERVICIO Y RESPONSABILIDAD

#### Infrastructure as a Service (IaaS)
**Usuario gestiona:**
- Sistema operativo
- Middleware
- Aplicaciones
- Datos

**Proveedor gestiona:**
- Hardware f√≠sico
- Red
- Virtualizaci√≥n

**Ejemplos:** AWS EC2, Azure VMs, Google Compute Engine

---

#### Platform as a Service (PaaS)
**Usuario gestiona:**
- Aplicaciones
- Datos

**Proveedor gestiona:**
- Runtime
- Middleware
- Sistema operativo
- Virtualizaci√≥n
- Hardware

**Ejemplos:** Heroku, Google App Engine, Azure App Service

---

#### Software as a Service (SaaS)
**Usuario gestiona:**
- Uso y configuraci√≥n
- Gesti√≥n de usuarios

**Proveedor gestiona:**
- Infraestructura completa
- Aplicaci√≥n
- Datos de la plataforma

**Ejemplos:** Gmail, Office 365, Salesforce

---

### üîê SHARED RESPONSIBILITY MODEL

| Componente | On-Premises | IaaS | PaaS | SaaS |
|------------|-------------|------|------|------|
| Datos | Cliente | Cliente | Cliente | Cliente |
| Aplicaciones | Cliente | Cliente | Cliente | Proveedor |
| Runtime | Cliente | Cliente | Proveedor | Proveedor |
| OS | Cliente | Cliente | Proveedor | Proveedor |
| Virtualizaci√≥n | Cliente | Proveedor | Proveedor | Proveedor |
| Hardware | Cliente | Proveedor | Proveedor | Proveedor |
| Red f√≠sica | Cliente | Proveedor | Proveedor | Proveedor |

**Principio fundamental:**
> "La nube es compartida, la responsabilidad no se terceriza."

---

### ‚òÅÔ∏è MODELOS DE DESPLIEGUE

#### Nube P√∫blica
- Infraestructura compartida entre m√∫ltiples organizaciones
- Gestionada por proveedores externos
- **Ejemplos:** AWS, Microsoft Azure, Google Cloud Platform
- **Ventajas:** Escalabilidad, bajo costo inicial, sin mantenimiento
- **Desventajas:** Menor control, dependencia del proveedor

#### Nube Privada
- Infraestructura dedicada a una organizaci√≥n
- Mayor control y personalizaci√≥n
- **Ejemplos:** OpenStack, VMware vCloud, on-premise
- **Ventajas:** Control total, cumplimiento normativo
- **Desventajas:** Alto costo, requiere mantenimiento

#### Nube H√≠brida
- Combinaci√≥n de nube p√∫blica y privada
- Permite migraci√≥n flexible de cargas de trabajo
- **Uso t√≠pico:** Datos sensibles en privada, procesamiento en p√∫blica

#### Nube Comunitaria
- Infraestructura compartida entre organizaciones con intereses comunes
- **Ejemplo:** Sector salud, instituciones gubernamentales

---

### ‚ö†Ô∏è RIESGOS T√çPICOS EN CLOUD

#### 1. Configuraciones Err√≥neas (Misconfiguration)
- **Problema m√°s com√∫n (65% de las brechas)**
- Buckets S3 p√∫blicos
- ACLs mal definidas
- Grupos de seguridad abiertos (0.0.0.0/0)
- Snapshots p√∫blicos

#### 2. Gesti√≥n Deficiente de Credenciales
- Claves hardcodeadas en c√≥digo fuente
- Secrets en repositorios p√∫blicos
- Credenciales con permisos excesivos
- Falta de rotaci√≥n de claves

#### 3. Logs con Datos Sensibles
- Logs con informaci√≥n de usuarios
- Contrase√±as en logs de aplicaci√≥n
- Tokens de autenticaci√≥n expuestos
- Logs sin cifrado

#### 4. Usuarios con Permisos Excesivos
- Violaci√≥n del principio de m√≠nimo privilegio
- Cuentas de servicio con permisos de admin
- Ausencia de MFA
- Falta de segregaci√≥n de funciones

#### 5. Dependencia de Terceros
- Problemas de compliance
- Falta de visibilidad
- Cambios unilaterales de t√©rminos
- Dependencia tecnol√≥gica (vendor lock-in)

---

### üõ°Ô∏è CONTROLES ESENCIALES

#### Identity and Access Management (IAM)
- Principio de m√≠nimo privilegio
- Autenticaci√≥n multifactor (MFA) obligatoria
- Pol√≠ticas basadas en roles (RBAC)
- Revisi√≥n peri√≥dica de permisos

#### Cifrado
- **En tr√°nsito:** TLS 1.2+ obligatorio
- **En reposo:** AES-256 para datos sensibles
- Gesti√≥n de claves con KMS
- Cifrado de snapshots y backups

#### Logging y Monitoreo Centralizado
- **AWS:** CloudTrail, GuardDuty, Security Hub
- **Azure:** Azure Monitor, Security Center
- **GCP:** Cloud Logging, Security Command Center
- Alertas en tiempo real
- Retenci√≥n de logs (m√≠nimo 90 d√≠as)

#### Evaluaci√≥n de Configuraci√≥n
- Cloud Security Posture Management (CSPM)
- Auditor√≠as automatizadas
- Compliance continuo
- Remediaci√≥n autom√°tica

#### Backups y Snapshots Seguros
- Backups cifrados
- Almacenamiento en regi√≥n diferente
- Pruebas de restauraci√≥n peri√≥dicas
- Versionado de snapshots

---

### üñ•Ô∏è VIRTUALIZACI√ìN Y SUS RIESGOS

#### Conceptos de Virtualizaci√≥n
- **Hipervisor Tipo 1:** Bare-metal (ESXi, Hyper-V, KVM)
- **Hipervisor Tipo 2:** Hosted (VirtualBox, VMware Workstation)

#### Riesgos Espec√≠ficos

**1. VM Escape**
- Explotaci√≥n de vulnerabilidades en el hipervisor
- Acceso del guest al host
- Compromiso de otras VMs

**2. Snapshots No Cifrados**
- Contienen datos sensibles
- Pueden ser copiados
- Persisten credenciales

**3. Redes Virtuales Sin Segmentaci√≥n**
- Lateral movement facilitado
- Falta de micro-segmentaci√≥n
- Ausencia de inspection del tr√°fico este-oeste

**4. Resource Exhaustion**
- DoS mediante consumo de recursos
- Falta de l√≠mites por VM
- Impacto en otras VMs (noisy neighbor)

#### Caso Real: Ataque VENOM
**CVE-2015-3456**
- Vulnerabilidad en QEMU/KVM
- Permit√≠a escape de VM
- Afect√≥ a millones de instancias
- **Lecci√≥n:** Mantener hipervisores actualizados

---

### üìã MARCO NORMATIVO

#### ISO 27017
- Controles de seguridad para servicios cloud
- Gu√≠a basada en ISO 27002
- Define responsabilidades entre proveedor y cliente

#### ISO 27018
- Protecci√≥n de datos personales en nube p√∫blica
- Transparencia en el tratamiento de datos
- Derechos de los titulares de datos

#### NIST SP 800-144
- Cloud Computing Security Guidelines
- Mejores pr√°cticas para adopci√≥n segura
- Framework de evaluaci√≥n de riesgos

#### Normativa Argentina

**Ley 25.326 - Protecci√≥n de Datos Personales**
- Regulaci√≥n del tratamiento de datos
- Derechos de acceso, rectificaci√≥n y supresi√≥n
- Obligaciones de seguridad

**Ley 27.078 - Argentina Digital**
- Neutralidad de la red
- Protecci√≥n de datos de los usuarios
- Infraestructura de telecomunicaciones

**GDPR (Aplicable a datos de ciudadanos UE)**
- Right to be forgotten
- Data portability
- Privacy by design

---

### üì∞ CASO REAL: NASA S3 LEAK (2018)

**Descripci√≥n del Incidente:**
- Exposici√≥n de logs de empleados de la NASA
- Bucket S3 con permisos p√∫blicos
- Acceso sin autenticaci√≥n

**Causa Ra√≠z:**
- ACL configurada como "Everyone: Read"
- Falta de revisi√≥n de permisos
- Ausencia de alertas de configuraci√≥n p√∫blica

**Impacto:**
- Exposici√≥n de informaci√≥n sensible
- Datos personales de empleados
- P√©rdida de reputaci√≥n

**Lecciones Aprendidas:**
1. Revisar permisos ANTES de crear recursos
2. Implementar pol√≠ticas preventivas (SCP)
3. Monitoreo continuo de configuraciones
4. Automatizar la detecci√≥n de exposiciones

**Remediaci√≥n:**
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Deny",
    "Principal": "*",
    "Action": "s3:*",
    "Resource": "*",
    "Condition": {
      "StringEquals": {
        "s3:x-amz-acl": ["public-read", "public-read-write"]
      }
    }
  }]
}
```

---

### üí° MEJORES PR√ÅCTICAS

#### Dise√±o Seguro
- Security by design desde el inicio
- Zero Trust Architecture
- Defensa en profundidad
- Separaci√≥n de entornos (dev/staging/prod)

#### Operaci√≥n Segura
- Automatizaci√≥n de controles
- Infrastructure as Code (IaC)
- GitOps para gesti√≥n de infraestructura
- Pipelines de seguridad en CI/CD

#### Monitoreo y Respuesta
- SIEM integrado con cloud
- Playbooks de respuesta a incidentes
- Threat intelligence feeds
- Purple teaming peri√≥dico

#### Gesti√≥n de Vulnerabilidades
- Escaneo continuo de im√°genes
- Parches automatizados
- Inventario de assets actualizado
- Vulnerability management program

---

## CIERRE TE√ìRICO

> **Mensaje clave:**
> "La nube no elimina la seguridad: la multiplica."

**Principios fundamentales para recordar:**

1. **Responsabilidad compartida** - Conoce qu√© gestiona el proveedor y qu√© gestionas t√∫
2. **M√≠nimo privilegio** - Otorga solo los permisos necesarios
3. **Auditor√≠a continua** - Lo que no se mide, no se puede mejorar
4. **Automatizaci√≥n** - Reduce el error humano
5. **Visibilidad total** - No puedes proteger lo que no ves

---

## üß™ PARTE PR√ÅCTICA - LABORATORIO

### Objetivo General
Identificar configuraciones inseguras, crear pol√≠ticas de acceso seguras y aplicar buenas pr√°cticas de auditor√≠a en entornos cloud y virtualizados.

### Requisitos

#### Software
- Python 3.8+
- boto3 (AWS SDK)
- awscli
- Docker (para LocalStack)
- VirtualBox o Proxmox (para virtualizaci√≥n)

#### Entornos
- Cuenta AWS (Free Tier) o LocalStack
- Entorno Linux/Kali/Ubuntu
- VSCode o IDE de preferencia
- Conexi√≥n a Internet

#### Conocimientos Previos
- Python b√°sico
- CLI de Linux
- Conceptos de redes
- Fundamentos de AWS

---

### üìÅ ESTRUCTURA DEL LABORATORIO

```
clase7/
‚îú‚îÄ‚îÄ README.md                          (este archivo)
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ detect_public_buckets.py      (Ejercicio 1)
‚îÇ   ‚îú‚îÄ‚îÄ check_security_groups.py      (Script adicional)
‚îÇ   ‚îú‚îÄ‚îÄ audit_iam_users.py            (Script adicional)
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ SETUP.md                      (Gu√≠a de configuraci√≥n)
‚îÇ   ‚îú‚îÄ‚îÄ EJERCICIOS.md                 (Gu√≠a detallada de ejercicios)
‚îÇ   ‚îî‚îÄ‚îÄ TROUBLESHOOTING.md
‚îî‚îÄ‚îÄ templates/
    ‚îú‚îÄ‚îÄ IAM_policy_example.json       (Ejercicio 2)
    ‚îú‚îÄ‚îÄ bucket_policy_secure.json
    ‚îî‚îÄ‚îÄ reporte_template.md
```

---

### üéØ EJERCICIOS

Los ejercicios se encuentran detallados en:
- **[docs/EJERCICIOS.md](docs/EJERCICIOS.md)** - Gu√≠a paso a paso
- **[docs/SETUP.md](docs/SETUP.md)** - Configuraci√≥n del entorno

#### Resumen de Ejercicios:

1. **Escaneo de Configuraciones Inseguras**
   Script Python para detectar buckets S3 p√∫blicos

2. **Pol√≠tica IAM Segura**
   Creaci√≥n de pol√≠ticas con m√≠nimo privilegio

3. **Simulaci√≥n de Vulnerabilidad y Remediaci√≥n**
   Crear exposici√≥n, detectar y remediar

4. **Seguridad en Entornos Virtualizados**
   Auditor√≠a de VMs con nmap y hardening

---

### üì§ ENTREGA DEL LABORATORIO

**Archivo:** `reporte_cloud_security_<grupo>.pdf`

**Estructura del reporte:**

1. **Introducci√≥n**
   - Objetivos del laboratorio
   - Alcance del an√°lisis

2. **Entorno**
   - Descripci√≥n de la infraestructura
   - Herramientas utilizadas

3. **Hallazgos**
   - Vulnerabilidades identificadas
   - Nivel de riesgo (Alto/Medio/Bajo)
   - Evidencias (capturas de pantalla)

4. **Mitigaciones**
   - Controles implementados
   - Configuraciones aplicadas
   - Verificaci√≥n post-remediaci√≥n

5. **Conclusiones**
   - Lecciones aprendidas
   - Recomendaciones para producci√≥n
   - Pr√≥ximos pasos

**Plantilla disponible en:** [templates/reporte_template.md](templates/reporte_template.md)

---

## üéì RECURSOS ADICIONALES

### Documentaci√≥n Oficial
- [AWS Well-Architected Framework](https://aws.amazon.com/architecture/well-architected/)
- [Azure Security Best Practices](https://docs.microsoft.com/en-us/azure/security/)
- [GCP Security Command Center](https://cloud.google.com/security-command-center)

### Herramientas Open Source
- **ScoutSuite** - Multi-cloud security auditing
- **Prowler** - AWS security assessment
- **CloudSploit** - Cloud security scanner
- **Trivy** - Container vulnerability scanner

### Certificaciones Relevantes
- AWS Certified Security - Specialty
- Azure Security Engineer Associate
- Google Professional Cloud Security Engineer
- CCSK (Certificate of Cloud Security Knowledge)

### Libros Recomendados
- "Cloud Security and Privacy" - Tim Mather
- "AWS Security" - Dylan Shield
- "Kubernetes Security" - Liz Rice

---

## üîç CIERRE Y REFLEXI√ìN FINAL

> "La nube no es insegura. Lo inseguro es no entender qui√©n es responsable."

### Estad√≠sticas para reflexionar:
- 90% de las brechas cloud son por errores humanos
- 67% de las organizaciones no tienen visibilidad completa de su infraestructura cloud
- El tiempo promedio para detectar una brecha es de 206 d√≠as

### Conclusiones clave:

1. **La seguridad es un proceso continuo**
   No es un producto que se compra, es una pr√°ctica que se cultiva

2. **La automatizaci√≥n es tu aliada**
   Pero la auditor√≠a manual sigue siendo fundamental

3. **El auditor moderno combina:**
   - T√©cnica (conocimiento de herramientas)
   - Gesti√≥n (pol√≠ticas y procesos)
   - Criterio humano (an√°lisis de contexto)

4. **La responsabilidad compartida no es excusa**
   Aunque el proveedor gestione la infraestructura, t√∫ gestionas la configuraci√≥n

5. **La visibilidad es el primer paso**
   No puedes proteger lo que no conoces

---

## üìû CONTACTO Y SOPORTE

**Instructor:** UTN - Laboratorio de Blockchain y Ciberseguridad

**Consultas:**
- Durante las clases pr√°cticas
- Foro de la materia
- Email institucional

---

## üìÑ LICENCIA

¬© 2025 ‚Äì Universidad Tecnol√≥gica Nacional (UTN)
Laboratorio de Blockchain y Ciberseguridad

Material educativo de uso acad√©mico.

---

**Versi√≥n:** 1.0
**√öltima actualizaci√≥n:** Octubre 2025
**Autor:** UTN - Laboratorio de Ciberseguridad
